!function(){"use strict";var o=function(o,e,n,t,i){var a=this;a.title=o,a.category=e,a.info=n,a.lat=t,a.lng=i,a.log=function(){console.log(a)},a.addToMap=function(o){a.marker=new google.maps.Marker({position:{lat:a.lat,lng:a.lng},map:o,title:a.title}),google.maps.event.addListener(a.marker,"click",function(){a.marker.map.panTo(a.marker.position),o.infoWindow.setContent(a.info),console.log(o.infoWindow),o.infoWindow.open(o,a.marker),a.marker.map.panBy(0,-100),a.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){a.marker.setAnimation(null)},1440)}),a.clicked=function(){google.maps.event.trigger(a.marker,"click")},a.hide=function(){a.marker.setMap(null)},a.show=function(){a.marker.setMap(o)}}},e=function(e){function n(){if("undefined"==typeof google)return console.log("No google variable"),null;var o={center:r.mapCenter,zoom:15,disableDefaultUI:!0},e=new google.maps.Map(document.getElementById("map"),o);return e.infoWindow=new google.maps.InfoWindow,e}function t(o,e){var n=ko.utils.arrayFirst(r.categories(),function(e){return o===e.categoryName});if(!n){var t={categoryName:o,pluralName:e,isSelected:!0};r.categories.push(t)}}function i(){var o="https://api.foursquare.com/v2/venues/explore?ll="+s+","+l+"&limit=30&oauth_token=XWDKSEKZ0FTNFJMOJ1SA5MSSA1HZVCMPTTZ5DYJUX0YFI3K4&v=20150509";$.getJSON(o,function(o){console.log(o);for(var e=o.response.groups[0].items,n=0;n<e.length;n++){var t=a(e[n].venue);t.addToMap(r.map),r.locations.push(t)}}).fail(function(){console.log("Unable to complete FourSquare request")})}function a(e){var n=e.name,i=e.categories[0].name,a='<div id="info-window"><h1 id="info-name">'+n+'</h1><div id=info-category">'+i+'</div><div id="info-body">';e.location&&e.location.formattedAddress&&(a+="<p>"+e.location.formattedAddress[0]+"<br>"+e.location.formattedAddress[1]+"<br>"+e.location.formattedAddress[2]+"</p>"),e.contact&&e.contact.formattedPhone&&(a+="<p>"+e.contact.formattedPhone+"</p>"),e.hours&&e.hours.status&&(a+="<p>"+e.hours.status+"</p>"),a+="</div></div>";var r=e.location.lat,s=e.location.lng;return t(e.categories[0].name,e.categories[0].pluralName),new o(n,i,a,r,s)}var r=this,s=49.2802736,l=-123.1237418;r.mapCenter={lat:s,lng:l},r.map=n(),r.locations=ko.observableArray([]),r.categories=ko.observableArray([]),r.isSearching=ko.observable(!0),r.shouldShowLocations=ko.observable(!0),r.isSearching.subscribe(function(o){window.setTimeout(function(){r.shouldShowLocations(o)},100)}),r.toggleLocationsVisible=function(){r.shouldShowLocations(!r.shouldShowLocations())},i(),r.currentFilter=ko.observable(),r.filteredLocations=ko.computed(function(){return r.currentFilter()?ko.utils.arrayFilter(r.locations(),function(o){return o.title.toLowerCase().indexOf(r.currentFilter().toLowerCase())>-1?(o.show(),!0):(o.hide(),!1)}):(ko.utils.arrayForEach(r.locations(),function(o){o.show()}),r.locations())}),r.filter=function(){r.currentFilter()},r.searchResultsClicked=function(o){console.log(o),o.clicked()},window.addEventListener("resize",function(){r.map.setCenter(r.mapCenter),google.maps.event.trigger(map,"resize")})},n=new e;ko.applyBindings(n)}();